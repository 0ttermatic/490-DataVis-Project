<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Death Locations</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../javascript/functions.js"></script> 
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #1c1c1c;
        }
        svg {
            border: 1px solid #ccc;
        }
        .death-marker {
            stroke: black;
            stroke-width: 1;
            font-size: 14px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <script>
        // Path to the .json file
        const PathToFile = "../Data_Gathering/match_data_FINAL.json"; 
    
        // Map Width and Height
        const MapHeight = 1020;
        const MapWidth = 1020;
 

        const GridSize = 34; // Grid size 

        const numCols = MapWidth / GridSize; // Number of columns in the grid
        const numRows = MapHeight / GridSize; // Number of rows in the grid

        // Color scale for the heatmap
        const colorScale = d3.scaleLinear()
        .domain([6, 12, 15, 18, 30, 69]) // Domain 
        .range(["rgba(255, 255, 255, 0)", "rgba(255, 210, 0, 1)", "rgba(255, 150, 0, .8)", "rgba(255, 130, 0, .8)", "rgba(255, 75, 0, .8)", "rgba(255, 0, 0, 1)"]); // RGBA with capacity


        // Load and process the data
        JsonToVariable(PathToFile).then(data => {
    
    
            // Extract death locations and the side from the data
            const deathLocationsWithSide = data.map(entry => {
                return entry.deathLocations.map(loc => ({
                    x: loc.x, // Attach x coordinate
                    y: loc.y, // Attach y coordinate
                    side: entry.side, // Attach side value 
                    championName: entry.championName // Attach champion name
                }));
            }).flat();
 
           
            // Scale the coordinates 
            const scaleCoordinates = (loc) => {
                const xScaled = (loc.x / 15000) * MapWidth;
                const yScaled = MapHeight - (loc.y / 15000) * MapHeight;
                const row = Math.floor(yScaled / GridSize);
                const col = Math.floor(xScaled / GridSize);
                return {
                    x: xScaled,
                    y: yScaled,
                    side: loc.side,
                    championName: loc.championName,
                    row: row,
                    col: col
                };
            }; 

            const scaledLocations = deathLocationsWithSide.map(scaleCoordinates);
            console.log("Scaled Locations:", scaledLocations);


            const deathCounts = Array.from({ length: numRows }, () => Array(numCols).fill(0));
            // Number of deaths in each grid cell
            scaledLocations.forEach(loc => {
                const row = Math.floor(loc.y / GridSize);
                const col = Math.floor(loc.x / GridSize);
                deathCounts[row][col]++;
            });

            // Plot the image of Summoner's Rift
            const svg = d3.select("body")
                .append("svg")
                .attr("width", MapWidth)
                .attr("height", MapHeight);
    
            svg.append("image")
                .attr("href", "Summoner's_Rift_Minimap.png")
                .attr("width", MapWidth)
                .attr("height", MapHeight);
    



            // Plot the grid cells (heatmap) 
            svg.selectAll(".grid-cell")
                .data(d3.range(numRows * numCols))
                .enter()
                .append("rect")
                .attr("class", "grid-cell")
                .attr("x", d => (d % numCols) * GridSize)
                .attr("y", d => Math.floor(d / numCols) * GridSize)
                .attr("width", GridSize)
                .attr("height", GridSize)
                .style("fill", d => {
                    const row = Math.floor(d / numCols);
                    const col = d % numCols;
                    const deathCount = deathCounts[row][col];
                    return colorScale(deathCount); // Set color based on the death count
                })
                .style("stroke", "none")
                .style("filter", "blur(14px)"); // Apply blur effect



            const unmappedChampions = scaledLocations.filter(d => !ChampionRoles[d.championName]);
            console.log("Unmapped Champions:", unmappedChampions);

        }).catch(error => console.error("Error loading or processing data:", error));

        
    </script>
</body>
</html>